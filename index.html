<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#f7f4ef">
  <meta name="description" content="여행 준비를 위한 일본어 단어 학습 앱">

  <!-- PWA -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="단어장">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon.png">

  <title>일본어 단어장</title>

  <!-- CSS -->
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/card.css">
  <link rel="stylesheet" href="css/calendar.css">
</head>
<body>

<div id="app">

  <!-- ── 앱 헤더 ───────────────────────────────────────── -->
  <header class="app-header">
    <h1 class="app-header__title">
      <span>言葉</span> 단어장
    </h1>
  </header>

  <!-- ── 탭 콘텐츠 ─────────────────────────────────────── -->
  <main class="tab-content">

    <!-- ① 홈 탭 -->
    <section id="home-tab">
      <p class="section-title">📚 카테고리 선택</p>
      <div id="home-summary"></div>
      <div id="category-list-home"></div>
    </section>

    <!-- ② 학습 탭 -->
    <section id="study-tab" class="hidden">

      <!-- 진행률 -->
      <div class="study-header">
        <div class="progress-info">
          <span id="progress-text">0 / 0</span>
        </div>
        <div class="progress-bar">
          <div id="progress-fill" style="width:0%"></div>
        </div>
      </div>

      <!-- 카드 -->
      <div class="card-container">
        <div id="study-card">
          <!-- 앞면: 일본어 -->
          <div id="card-front" class="card-face">
            <span id="card-category"></span>
            <div id="card-japanese"></div>
            <button id="btn-speak" class="btn-speak" title="발음 듣기">🔊</button>
          </div>
          <!-- 뒷면: 한글 뜻 -->
          <div id="card-back" class="card-face">
            <div id="card-korean"></div>
          </div>
        </div>
      </div>

      <!-- 정답/오답 버튼 -->
      <div id="answer-buttons" class="hidden">
        <button id="btn-wrong">
          <span class="btn-answer-icon">❌</span>
          <span class="btn-answer-label">틀림</span>
        </button>
        <button id="btn-correct">
          <span class="btn-answer-icon">✅</span>
          <span class="btn-answer-label">맞음</span>
        </button>
      </div>

      <!-- 학습 결과 -->
      <div id="study-result" class="hidden">
        <div class="result-header">
          <p class="result-title">학습 완료 🎉</p>
          <div id="result-score"></div>
        </div>
        <div id="result-wrong-list"></div>
        <div class="result-buttons">
          <button id="btn-retry">다시 풀기</button>
          <button id="btn-home">홈으로</button>
        </div>
      </div>

    </section>

    <!-- ③ 기록 탭 -->
    <section id="calendar-tab" class="hidden">
      <p class="section-title">📅 학습 기록</p>

      <div class="calendar-wrap">
        <!-- 헤더 + 통계 -->
        <div class="calendar-header">
          <span class="calendar-title">연간 학습 현황</span>
          <div class="calendar-stats">
            <span class="stat-badge">📆 <strong id="stat-days">0</strong>일</span>
            <span class="stat-badge">📝 <strong id="stat-words">0</strong>개</span>
          </div>
        </div>

        <!-- 가로 스크롤 영역 -->
        <div class="calendar-scroll">
          <!-- 월 레이블 -->
          <div id="calendar-months"></div>

          <!-- 요일 + 그리드 -->
          <div class="calendar-inner">
            <div class="calendar-weekdays">
              <span class="weekday-label">일</span>
              <span class="weekday-label">월</span>
              <span class="weekday-label">화</span>
              <span class="weekday-label">수</span>
              <span class="weekday-label">목</span>
              <span class="weekday-label">금</span>
              <span class="weekday-label">토</span>
            </div>
            <div id="calendar-grid"></div>
          </div>
        </div>

        <!-- 범례 -->
        <div id="calendar-legend"></div>

        <!-- 툴팁 -->
        <div id="calendar-tooltip" class="hidden"></div>
      </div>
    </section>

    <!-- ④ 설정 탭 -->
    <section id="settings-tab" class="hidden">
      <p class="section-title">⚙️ 설정</p>

      <!-- 단어 관리 -->
      <div class="settings-section">
        <p class="section-title">✏️ 단어 추가</p>

        <!-- 단어 하나씩 입력 -->
        <div class="form-group">
          <label class="form-label" for="input-japanese">일본어</label>
          <input class="form-input" type="text" id="input-japanese"
            placeholder="예) 食べる" autocomplete="off">
        </div>
        <div class="form-group">
          <label class="form-label" for="input-furigana">후리가나 <span style="font-weight:400;color:var(--clr-ink-faint)">(선택)</span></label>
          <input class="form-input" type="text" id="input-furigana"
            placeholder="예) たべる" autocomplete="off">
        </div>
        <div class="form-group">
          <label class="form-label" for="input-korean">한글 뜻</label>
          <input class="form-input" type="text" id="input-korean"
            placeholder="예) 먹다" autocomplete="off">
        </div>
        <div class="form-group">
          <label class="form-label" for="select-category">카테고리</label>
          <select class="form-select" id="select-category"></select>
        </div>
        <button class="btn btn--primary btn--full" id="btn-add-word">단어 추가</button>
        <div class="form-msg hidden" id="word-form-msg"></div>

        <hr class="divider">

        <!-- CSV 대량 업로드 -->
        <p class="form-label" style="margin-bottom:var(--space-sm)">CSV 대량 업로드</p>
        <div class="csv-upload-area" id="csv-upload-area">
          <div class="csv-upload-icon">📂</div>
          <p class="csv-upload-text">
            CSV 파일을 선택하세요<br>
            <small>형식: 일본어, 후리가나, 한글뜻, 카테고리</small>
          </p>
        </div>
        <input type="file" id="input-csv" accept=".csv" style="display:none">
        <button class="btn btn--outline btn--full" id="btn-upload-csv">📂 CSV 파일 선택</button>
        <div class="form-msg hidden" id="csv-msg"></div>
      </div>

      <!-- 단어 목록 -->
      <div class="settings-section">
        <div class="word-list-header">
          <p class="section-title" style="margin-bottom:0;border:none">📋 단어 목록</p>
          <select class="form-select" id="word-list-filter"
            style="width:auto;padding:6px 28px 6px 10px;font-size:.8rem"></select>
        </div>
        <div id="word-list"></div>
      </div>

      <!-- 카테고리 관리 -->
      <div class="settings-section">
        <p class="section-title">🗂 카테고리 관리</p>
        <div id="category-list"></div>
        <hr class="divider">
        <div style="display:flex;gap:var(--space-sm)">
          <input class="form-input" type="text" id="input-category-name"
            placeholder="새 카테고리 이름" style="flex:1">
          <button class="btn btn--primary" id="btn-add-category">추가</button>
        </div>
        <div class="form-msg hidden" id="cat-form-msg"></div>
      </div>

      <!-- 백업 & 복원 -->
      <div class="settings-section">
        <p class="section-title">💾 백업 & 복원</p>
        <div class="backup-buttons">
          <button class="btn btn--outline" id="btn-export-json">📤 JSON 내보내기</button>
          <button class="btn btn--outline" id="btn-import-json">📥 JSON 가져오기</button>
          <button class="btn btn--outline" id="btn-export-csv" style="grid-column:1/-1">
            📊 CSV 내보내기 (단어장)
          </button>
        </div>
        <input type="file" id="input-import-json" accept=".json" style="display:none">
      </div>

      <!-- 학습 설정 -->
      <div class="settings-section">
        <p class="section-title">🎯 학습 설정</p>

        <div class="setting-row">
          <div class="setting-label">
            하루 학습 단어 수
            <small>기본 10개</small>
          </div>
          <input class="setting-input" type="number" id="setting-daily-goal"
            min="1" max="100" value="10">
        </div>

        <div class="setting-row">
          <div class="setting-label">
            오답 졸업 연속 정답
            <small>N번 연속 맞히면 오답 해제</small>
          </div>
          <input class="setting-input" type="number" id="setting-graduation-streak"
            min="1" max="10" value="3">
        </div>

        <hr class="divider">

        <p class="form-label" style="margin-bottom:var(--space-md)">
          잔디 색상 기준 (단어 수)
        </p>

        <div class="setting-row">
          <div class="setting-label">
            🟩 기본 (연한 색)
          </div>
          <input class="setting-input" type="number" id="setting-grass-1"
            min="1" value="10">
        </div>

        <div class="setting-row">
          <div class="setting-label">
            🟩 놀람 (중간 색)
          </div>
          <input class="setting-input" type="number" id="setting-grass-2"
            min="1" value="20">
        </div>

        <div class="setting-row">
          <div class="setting-label">
            🟩 최고 (진한 색)
          </div>
          <input class="setting-input" type="number" id="setting-grass-3"
            min="1" value="30">
        </div>

        <button class="btn btn--primary btn--full" id="btn-save-settings"
          style="margin-top:var(--space-md)">
          설정 저장
        </button>
        <div class="form-msg hidden" id="settings-msg"></div>
      </div>

    </section>

  </main>

  <!-- ── 하단 탭 네비게이션 ─────────────────────────────── -->
  <nav class="tab-nav">
    <button class="tab-nav__item active" data-tab="home">
      <span class="tab-icon">🏠</span>
      <span>홈</span>
    </button>
    <button class="tab-nav__item" data-tab="study">
      <span class="tab-icon">📖</span>
      <span>학습</span>
    </button>
    <button class="tab-nav__item" data-tab="calendar">
      <span class="tab-icon">📅</span>
      <span>기록</span>
    </button>
    <button class="tab-nav__item" data-tab="settings">
      <span class="tab-icon">⚙️</span>
      <span>설정</span>
    </button>
  </nav>

</div><!-- /#app -->

<!-- ── JS (의존성 순서대로 로드) ─────────────────────────── -->
<script src="js/storage.js"></script>
<script src="js/data.js"></script>
<script src="js/csv.js"></script>
<script src="js/quiz.js"></script>
<script src="js/settings.js"></script>
<script src="js/card.js"></script>
<script src="js/calendar.js"></script>
<script src="js/app.js"></script>

<!-- ── Service Worker 등록 ───────────────────────────────── -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./service-worker.js')
        .then(reg => console.log('[SW] 등록 완료:', reg.scope))
        .catch(err => console.warn('[SW] 등록 실패:', err));
    });
  }
</script>

</body>
</html>

